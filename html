<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Candy Burst</title>
  <style>
    :root { --max-candies: 220; }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      min-height: 100svh;
      display: grid;
      place-items: center;
      background: radial-gradient(1200px 800px at 50% 40%, #ffe7f1 0%, #f3f8ff 60%, #e8f1ff 100%);
      overflow: hidden;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
    }

    #stage {
      position: fixed;
      inset: 0;
      pointer-events: none;
      overflow: hidden;
    }

    #centerCandy {
      position: relative;
      z-index: 10;
      border: 0;
      background: none;
      padding: 0;
      cursor: pointer;
      transform: translateZ(0);
    }

    #centerCandy img {
      width: clamp(100px, 18vw, 180px);
      height: auto;
      display: block;
      image-rendering: pixelated;
      animation: pulse 1.3s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.06); }
    }

    .candy {
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      will-change: transform, opacity;
      user-select: none;
    }

    .candy img {
      width: var(--size);
      height: auto;
      display: block;
      image-rendering: pixelated;
    }

    @keyframes flyOut {
      0%   { transform: translate(-50%,-50%) scale(.7) rotate(0deg); opacity: .9; }
      100% { transform: translate(calc(-50% + var(--dx)), calc(-50% + var(--dy))) scale(1) rotate(var(--rot)); opacity: 1; }
    }

    @keyframes floaty {
      0%   { transform: translate(calc(-50% + var(--dx)), calc(-50% + var(--dy))) scale(1) rotate(var(--rot)); }
      100% { transform: translate(calc(-50% + var(--dx) + var(--fx)), calc(-50% + var(--dy) + var(--fy))) scale(1) rotate(calc(var(--rot) + var(--spin))); }
    }

    .candy.is-flying {
      animation: flyOut var(--dur) cubic-bezier(.15,.8,.25,1) forwards;
    }

    .candy.is-floating {
      animation: floaty var(--floatDur) ease-in-out infinite alternate;
    }

    #resetBtn {
      position: fixed; right: 14px; bottom: 14px;
      background: white; color: #333; border: 1px solid #dbe7ff;
      padding: 10px 14px; border-radius: 14px; cursor: pointer;
      box-shadow: 0 8px 20px rgba(0,0,0,.06);
      font-weight: 600; font-size: 14px;
    }
    #resetBtn:hover { background: #f6faff; }

    .hint {
      position: fixed; bottom: 14px; left: 50%; transform: translateX(-50%);
      color: #4a5568; font-size: 14px; opacity: .75;
    }
    @media (max-width: 640px) { .hint { display: none; } }
  </style>
</head>
<body>
  <div id="stage" aria-hidden="true"></div>

  <button id="centerCandy" aria-label="Pop candies" title="Click to pop candies (or press Space / Enter)">
    <img src="./pngtree-candy-pixel-icon-png-image_6138023.png" alt="Pixel Candy">
  </button>

  <button id="resetBtn" type="button" aria-label="Clear candies">Reset</button>
  <div class="hint">Click the candy to pop more! (Space/Enter works too)</div>

  <script>
    (function() {
      const stage = document.getElementById('stage');
      const btn = document.getElementById('centerCandy');
      const resetBtn = document.getElementById('resetBtn');

      function rand(min, max) { return Math.random() * (max - min) + min; }

      function spawnOne() {
        const el = document.createElement('span');
        el.className = 'candy is-flying';

        const img = document.createElement('img');
        img.src = './pngtree-candy-pixel-icon-png-image_6138023.png';
        img.alt = 'Candy';
        el.appendChild(img);

        const size = rand(30, 60);
        el.style.setProperty('--size', size + 'px');

        const angle = rand(0, Math.PI * 2);
        const dist = rand(120, 300);
        const dx = Math.cos(angle) * dist;
        const dy = Math.sin(angle) * dist;
        el.style.setProperty('--dx', dx.toFixed(2) + 'px');
        el.style.setProperty('--dy', dy.toFixed(2) + 'px');
        el.style.setProperty('--rot', rand(-180, 180).toFixed(1) + 'deg');
        el.style.setProperty('--dur', rand(420, 780).toFixed(0) + 'ms');

        const fx = rand(-6, 6), fy = rand(-6, 6), spin = rand(-6, 6);
        el.style.setProperty('--fx', fx.toFixed(1) + 'px');
        el.style.setProperty('--fy', fy.toFixed(1) + 'px');
        el.style.setProperty('--spin', spin.toFixed(1) + 'deg');
        el.style.setProperty('--floatDur', rand(2200, 3600).toFixed(0) + 'ms');

        setTimeout(() => el.remove(), 14000 + Math.random() * 4000);

        el.addEventListener('animationend', () => {
          el.classList.remove('is-flying');
          el.classList.add('is-floating');
        }, { once: true });

        stage.appendChild(el);
      }

      function burst(count = 12) {
        const existing = stage.querySelectorAll('.candy');
        if (existing.length > parseInt(getComputedStyle(document.documentElement).getPropertyValue('--max-candies'))) {
          const over = existing.length - parseInt(getComputedStyle(document.documentElement).getPropertyValue('--max-candies')) + count;
          for (let i = 0; i < over && i < existing.length; i++) existing[i].remove();
        }
        for (let i = 0; i < count; i++) setTimeout(spawnOne, i * 20);
      }

      btn.addEventListener('click', () => burst(14));
      btn.addEventListener('keydown', (e) => {
        if (e.key === ' ' || e.key === 'Enter') { e.preventDefault(); burst(14); }
      });
      resetBtn.addEventListener('click', () => {
        stage.querySelectorAll('.candy').forEach(el => el.remove());
      });

      setTimeout(() => burst(8), 600);
    })();
  </script>
</body>
</html>
